CREATE TABLE FILME (
    id_filme SERIAL PRIMARY KEY,
    titulo VARCHAR(150) NOT NULL UNIQUE,
    genero VARCHAR(50),
    classificacao VARCHAR(10),
    duracao INT
);

CREATE TABLE SALA (
    id_sala SERIAL PRIMARY KEY,
    capacidade INT NOT NULL
);

CREATE TABLE FUNCIONARIO (
    matricula SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    telefone VARCHAR(20),
    tipo_funcionario SMALLINT NOT NULL
);

CREATE TABLE INGRESSO (
    id_ingresso SERIAL PRIMARY KEY,
    forma_pagamento INT NOT NULL,
    tipo_ingresso SMALLINT NOT NULL,
    categoria_meia SMALLINT,
    fk_matricula_bilheteiro SMALLINT NOT NULL,
    FOREIGN KEY (fk_matricula_bilheteiro) REFERENCES FUNCIONARIO(matricula)
);

CREATE TABLE SESSAO (
    id_sessao SERIAL PRIMARY KEY,
    data DATE NOT NULL,
    horario TIME NOT NULL,
    fk_id_filme INT NOT NULL,
    fk_id_sala INT NOT NULL,
    FOREIGN KEY (fk_id_filme) REFERENCES FILME(id_filme),
    FOREIGN KEY (fk_id_sala) REFERENCES SALA(id_sala)
);

CREATE TABLE POLTRONA (
    id_poltrona SERIAL PRIMARY KEY,
    numero INT NOT NULL,
    fila VARCHAR(2) NOT NULL,
    fk_id_sala INT NOT NULL,
    FOREIGN KEY (fk_id_sala) REFERENCES SALA(id_sala),
    UNIQUE(numero, fila, fk_id_sala)
);

CREATE TABLE VIGILANCIA_SESSAO (
    fk_id_sessao INT NOT NULL,
    fk_matricula_vigia INT NOT NULL,
    FOREIGN KEY (fk_id_sessao) REFERENCES SESSAO(id_sessao),
    FOREIGN KEY (fk_matricula_vigia) REFERENCES FUNCIONARIO(matricula),
    PRIMARY KEY (fk_id_sessao, fk_matricula_vigia)
);

CREATE TABLE PERTENCE (
    fk_id_sessao INT NOT NULL,
    fk_id_ingresso INT NOT NULL,
    fk_id_poltrona INT NOT NULL,
    FOREIGN KEY (fk_id_sessao) REFERENCES SESSAO(id_sessao),
    FOREIGN KEY (fk_id_ingresso) REFERENCES INGRESSO(id_ingresso),
    FOREIGN KEY (fk_id_poltrona) REFERENCES POLTRONA(id_poltrona),
    PRIMARY KEY (fk_id_sessao, fk_id_ingresso),
    UNIQUE(fk_id_sessao, fk_id_poltrona)
);

INSERT INTO FILME (id_filme, titulo, genero, classificacao, duracao) VALUES 
(1, 'Matrix', 'Ficção Científica', '14', 136),
(2, 'O Auto da Compadecida', 'Comédia', '12', 104);

INSERT INTO SALA (id_sala, capacidade) VALUES 
(1, 50),
(2, 120);

INSERT INTO FUNCIONARIO (matricula, nome, telefone, tipo_funcionario) VALUES 
(1, 'Carlos Silva', '47 9999-1111', 1),
(2, 'Ana Souza', '47 9999-2222', 2);

INSERT INTO SESSAO (id_sessao, data, horario, fk_id_filme, fk_id_sala) VALUES 
(1, '2025-12-01', '14:00:00', 1, 1),
(2, '2025-12-01', '16:30:00', 2, 2);

INSERT INTO POLTRONA (id_poltrona, numero, fila, fk_id_sala) VALUES 
(1, 1, 'A', 1),
(2, 5, 'B', 2);

INSERT INTO INGRESSO (id_ingresso, forma_pagamento, tipo_ingresso, categoria_meia, fk_matricula_bilheteiro) VALUES 
(1, 4, 1, NULL, 2),
(2, 3, 2, 1, 2);

INSERT INTO VIGILANCIA_SESSAO (fk_id_sessao, fk_matricula_vigia) VALUES 
(1, 1),
(2, 1);

INSERT INTO PERTENCE (fk_id_sessao, fk_id_ingresso, fk_id_poltrona) VALUES 
(1, 1, 1),
(2, 2, 2);

SELECT setval('filme_id_filme_seq', 3, false);
SELECT setval('sala_id_sala_seq', 3, false);
SELECT setval('funcionario_matricula_seq', 3, false);
SELECT setval('sessao_id_sessao_seq', 3, false);
SELECT setval('poltrona_id_poltrona_seq', 3, false);
SELECT setval('ingresso_id_ingresso_seq', 3, false);